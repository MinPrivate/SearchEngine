document.write('<style type="text/css">.ip_pop{ border:4px solid #545454; width:672px;overflow:hidden; background:#fff;z-index:9000;}.ip_pop h2{ background:url(http://img.eduuu.com/website/aoshu/nav/images/tc_bt.png) repeat-x; height:38px; line-height:35px; margin:0px; font-size:18px; font-family:"微软雅黑"; font-weight:normal; padding-left:20px; color:#fff;}.ip_pop img{ border:none;}.ip_pop a{ text-decoration:none;}.ip_pop a:hover{ text-decoration:underline;}.ip_pop .clear{ height:0px; width:0px; margin:0px; padding:0px; font-size:0px; line-height:0px; clear:both;}.ip_close{ float:right; margin:8px 10px; 0 0; display:inline; cursor:pointer;}.ip_msg{ padding:0 20px; margin:0px; height:50px; line-height:50px; width:445px;font-size: 16px;}.ip_msg span{ display:block; float:right; background:url(http://img.eduuu.com/website/aoshu/nav/images/tc_bg1.png) no-repeat; width:79px; height:26px; line-height:26px; text-align:center; margin-top:13px;}.ip_msg span a{ font-size:14px; font-weight:bold; color:#fff;}.ip_popbox{ padding:0px 10px 10px 10px; overflow:hidden;}.ip_popbox h3{ font-size:14px; font-weight:bold; font-family:"宋体"; margin:0px; height:30px; line-height:30px; background:#F5F5F5; border-bottom:3px solid #ECECEC; padding-left:10px;}.ip_popbox p{ margin:0px; margin-top:10px; margin-left:10px; height:24px; float:left; width:300px; float:left; line-height:24px; display:inline;}.ip_popbox p span{ display:block; float:left; background:url(http://img.eduuu.com/website/aoshu/nav/images/tc_bg.png) no-repeat; height:23px; width:24px; color:#fff; font-size:14px; line-height:23px; text-align:center; font-size:18px; font-family:"微软雅黑";}.ip_popbox p strong{ float:right; width:276px; display:block; line-height:23px;}.ip_popbox p strong a{ color:#000; font-size:14px; margin:0 5px; display:inline; font-weight:normal; text-decoration:none;}.ip_popbox p strong a:hover{ text-decoration:underline;}.ip_txt{ height:46px; line-height:46px; font-size:14px;  font-family:"宋体";border-top:1px solid #E4E4E4;  margin:0px 20px; padding-left:10px;}.ip_txt a,.ip_txt a:link,.ip_txt a:visited{ color:#FF6600;}.ip_sidebg {position: fixed;z-index:8000;top: 0px;left: 0px;height:100%;width:100%;background-color: #F7F7F7;filter:alpha(opacity=75);-moz-opacity: 0.75;opacity: 0.75;}* html .ip_sidebg {position: absolute;height: expression(document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + "px");}.pop_tip{ width:258px;overflow:hidden; margin:0px; background:#fff;z-index:9000;}.pop_tip img{ border:none;}.pop_tip a{ text-decoration:none; color:#003366;}.pop_tip a:hover{ text-decoration:underline;}.pop_tip .clear{ height:0px; width:0px; margin:0px; padding:0px; font-size:0px; line-height:0px; clear:both;}.pop_tip .tipt{ background:url(http://img.eduuu.com/website/aoshu/nav/images/tipt.png) no-repeat; height:5px; margin:0px; overflow:hidden;}.pop_tip .tipc{ background:url(http://img.eduuu.com/website/aoshu/nav/images/tipc.png) repeat-y; overflow:hidden; margin:0px;}.pop_tip .tipb{ background:url(http://img.eduuu.com/website/aoshu/nav/images/tipb.png) no-repeat; overflow:hidden; margin:0px; height:5px;}.pop_tip .tipc h2{ margin:0px; font-size:12px; font-family:"宋体"; color:#003366; height:20px; line-height:20px;padding:5px 10px 0 15px;}.pop_tip .close{ float:right; display:inline; cursor:pointer;}.pop_tip .tipcont{ padding:0px 15px 10px;}.pop_tip .tipall{ height:36px; line-height:36px; font-size:12px;  font-family:"宋体";border-bottom:1px dashed #E4E4E4; text-align:center;}.pop_tip .tipall a{margin:0 5px; display:inline;}.pop_tip .tipmain{overflow:hidden;}.tipmain a{padding: 1px 2px;}.tipmain a:hover{background:#4EB332;color:#FFF;}.pop_tip .tipmain h3{ font-size:14px; font-weight:bold; font-family:"宋体"; margin:0px; height:30px; line-height:30px; background:#F5F5F5; border-bottom:3px solid #ECECEC; padding-left:10px;}.pop_tip .tipmain p{ margin:0px; margin-top:8px; height:20px; float:left; width:230px; float:left; line-height:20px; display:inline;}.pop_tip .tipmain p span{ display:block; float:left; background:url(http://img.eduuu.com/website/aoshu/nav/images/tc_bg3.png) no-repeat left center; height:20px; width:18px; color:#fff; font-size:14px; line-height:18px; text-align:center; font-size:14px; font-family:"微软雅黑";}.pop_tip .tipmain p strong{ float:right; width:210px; display:block; height:20px; line-height:20px;}.pop_tip .tipmain p strong a{font-size:12px; margin:0 5px; display:inline; font-weight:normal; text-decoration:none;}.pop_tip .tipmain p strong a:hover{ text-decoration:underline;}.ip_msg span a:link,.ip_msg span a:visited{color:#fff;};</style>');

var auHot=[
    {key:'bj',name:'北京',url:'bj.aoshu.com',grp:'B',itp:'1'},
    {key:'sh',name:'上海',url:'sh.aoshu.com',grp:'S',itp:'1'},
    {key:'gz',name:'广州',url:'gz.aoshu.com',grp:'G',itp:'1'},
    {key:'sz',name:'深圳',url:'sz.aoshu.com',grp:'S',itp:'1'}
];
var auCity=[

    {key:'bj',name:'北京',url:'bj.aoshu.com',grp:'B',itp:'1'},

    //{key:'cz',name:'常州',url:'cz.aoshu.com',grp:'C',itp:'0'},
    {key:'cs',name:'长沙',url:'cs.aoshu.com',grp:'C',itp:'0'},
    {key:'cd',name:'成都',url:'cd.aoshu.com',grp:'C',itp:'0'},
    {key:'cq',name:'重庆',url:'cq.aoshu.com',grp:'C',itp:'0'},
    //{key:'cc',name:'长春',url:'cc.aoshu.com',grp:'C',itp:'0'},

    {key:'dl',name:'大连',url:'dl.aoshu.com',grp:'D',itp:'0'},
    //{key:'dg',name:'东莞',url:'dg.aoshu.com',grp:'D',itp:'0'},

    //{key:'fs',name:'佛山',url:'fs.aoshu.com',grp:'F',itp:'0'},
    //{key:'fz',name:'福州',url:'fz.aoshu.com',grp:'F',itp:'0'},

    {key:'gz',name:'广州',url:'gz.aoshu.com',grp:'G',itp:'1'},

    {key:'hz',name:'杭州',url:'hz.aoshu.com',grp:'H',itp:'0'},
    {key:'hf',name:'合肥',url:'hf.aoshu.com',grp:'H',itp:'0'},

    {key:'jn',name:'济南',url:'jn.aoshu.com',grp:'J',itp:'0'},


    {key:'nj',name:'南京',url:'nj.aoshu.com',grp:'N',itp:'0'},
    {key:'nb',name:'宁波',url:'nb.aoshu.com',grp:'N',itp:'0'},
    //{key:'nn',name:'南宁',url:'nn.aoshu.com',grp:'N',itp:'0'},

    {key:'qd',name:'青岛',url:'qd.aoshu.com',grp:'Q',itp:'0'},

    {key:'sh',name:'上海',url:'sh.aoshu.com',grp:'S',itp:'1'},
    {key:'sz',name:'深圳',url:'sz.aoshu.com',grp:'S',itp:'1'},
    {key:'su',name:'苏州',url:'su.aoshu.com',grp:'S',itp:'0'},
    {key:'sy',name:'沈阳',url:'sy.aoshu.com',grp:'S',itp:'0'},
    {key:'sjz',name:'石家庄',url:'sjz.aoshu.com',grp:'S',itp:'0'},

    {key:'tj',name:'天津',url:'tj.aoshu.com',grp:'T',itp:'0'},
    {key:'ty',name:'太原',url:'ty.aoshu.com',grp:'T',itp:'0'},

    {key:'wx',name:'无锡',url:'wx.aoshu.com',grp:'W',itp:'0'},
    //{key:'wz',name:'温州',url:'wz.aoshu.com',grp:'W',itp:'0'},
    {key:'wh',name:'武汉',url:'wh.aoshu.com',grp:'W',itp:'0'},

    //{key:'xm',name:'厦门',url:'xm.aoshu.com',grp:'X',itp:'0'},
    {key:'xa',name:'西安',url:'xa.aoshu.com',grp:'X',itp:'0'},

    //{key:'zh',name:'珠海',url:'zh.aoshu.com',grp:'Z',itp:'0'},
    {key:'zz',name:'郑州',url:'zz.aoshu.com',grp:'Z',itp:'0'}
];

(function($){
    //是否为IE6
    var c={
        cnm: '__CITY_URL',
        uip: 'http://applib.eduu.com/sign/myip?fc=?',//获取IPURL地址
        ctm: 2592000,//cookie缓存时间3个月
        are: [],//地区缓存
        doc: document,
        loc: location,
        euc: encodeURIComponent,
        ckedomain: '.aoshu.com',//cookie域

        //设置Cookie(key,value,过期时间,路径,域名)
        setCke: function(n, v, t, h, d){
            var e = new Date();
            e.setTime(e.getTime() + t*1000);
            c.doc.cookie = n + "=" + v + (t ? "; expires=" + e.toGMTString() : "") + (d ? "; domain="+d : "") + (h ? "; path="+h : "");
        },
        //获取cookie
        getCke: function (l){
            var m = new RegExp("(^| )" + l + "=([^;]*)(;|\x24)");
            var k = m.exec(c.doc.cookie);
            if (k) {
                return k[2] || null;
            }
            return null;
        },
        //检查数组中是否存在该值
        getKey:function(A){
            for (var i in c.are ){
                if(c.are[i]==A) return [0,i];
            }
            return [1,(c.are.push(A)-1)];
        },
        //关闭cookie
        setClose:function(A){
            this.setCke(c.cnm,'0',c.ctm,'/',this.ckedomain);
            $('#'+A).remove();
            $('.ip_sidebg').remove();
        },
        //设置分站切换缓存
        setCity:function(A){
            this.setCke(c.cnm,A.href,c.ctm,'/',this.ckedomain);
            return true;
        },
        //设置跳转时间
        goTimeUrl:function(A,O,U){
            O.text(A);A=A-1;
            if (A<0){
                this.setCke(c.cnm,U,c.ctm,'/',this.ckedomain);
                window.location.href=U;
                return ;
            }
            setTimeout(function(){ c.goTimeUrl(A,O,U); },1000);
        },
        //显示列表
        showCity:function(A,O){
            c.createPop(A);

            //设置居中
            position.absolute("#"+A);

            //设置位置
            var o=$(O).offset();
            $("#"+A).css({left: o.left+"px",top: o.top+"px"});

            //创建窗体
            if (typeof c.doc.body.style.maxHeight === "undefined") {//if IE 6
                if ($('.ip_sidebg').length<=0){
                    $(document.body).append("<iframe class='ip_sidebg'></iframe>");
                }
                $('.ip_sidebg').css({position:'absolute',left:o.left+'px',top:o.top+'px',width:$("#"+A).width()+'px',height:$("#"+A).height()+'px'});
            }

            //设置点击缓存事件
            $('#'+A).show().find('div.tipmain a').click(function(){ return c.setCity(this);});
            $('.ip_sidebg').show();
        },
        //创建城市列表选择
        createCity:function(A,M){
            if ($('#'+A).length>0){ return ;}

            if (typeof c.doc.body.style.maxHeight === "undefined") {//if IE 6
                $(document.body).append("<iframe class='ip_sidebg'></iframe>");
            }

            $(document.body).append("<div class='ip_sidebg'></div><div id='"+A+"' class='ip_pop'><h2><a class='ip_close'><img src='http://img.eduuu.com/website/aoshu/nav/images/tc_gb.jpg' width='19'/></a>欢迎来到奥数网</h2><div><div class='ip_msg'></div><div class='ip_popbox'><h3>请选择您所在的城市</h3><div class='clear'></div></div><div class='ip_txt'>如果您所在的城市未开设奥数网分站，<a href='http://www.aoshu.com'>请进入全国站>></a></div></div></div>");

            //设置关闭按钮事件
            $('#'+A+' > h2 img').click(function(){c.setClose(A)});

            //创建城市选择
            var d=$('#'+A+' div.ip_popbox > div.clear'),_e,_msg="您的IP地址是： "+M.ip+" "+M.cn+"";
            for (var k in auCity){
                //进行分组检测
                _e=c.getKey(auCity[k].grp);

                //判断IP获取的站点
                if (M.en==auCity[k].key){
                    _msg+='，点击查看';
                    _msg='<span><a href="http://'+auCity[k].url+'/">'+auCity[k].name+'站</a></span>'+_msg;
                }

                //是否需要创建母体
                if (_e[0]==1){
                    d.before("<p id='_mip_"+_e[1]+"'><span>"+auCity[k].grp+"</span><strong></strong></p>");
                }
                $("#_mip_"+_e[1]+" > strong").append("<a href='http://"+auCity[k].url+"/'>"+auCity[k].name+"</a>");
            }

            $('#'+A + ' .ip_msg').html(_msg);

            //设置定位居中
            var _h=($(window).height()-$("#"+A).height())/2;
            var _w=($(window).width()-$("#"+A).width())/2;
            $("#"+A).css({left: _w+"px",top: _h+"px"});
        },
        //创建城市列表
        createPop:function(A){
            if ($('#'+A).length>0){ return ;}

            $(document.body).append("<div id='"+A+"' class='pop_tip'><div class='tipt'></div><div class='tipc'><h2><a class='close'><img src='http://img.eduuu.com/website/aoshu/nav/images/gb_bg.jpg' width='17'/></a>热门城市</h2><div class='tipcont'><div class='tipmain'><div class='tipall'><a href='http://www"+this.ckedomain+"'>全国</a><a href='http://bj.aoshu.com/'>北京</a><a href='http://sh.aoshu.com/'>上海</a><a href='http://gz.aoshu.com/'>广州</a><a href='http://sz.aoshu.com/'>深圳</a></div><div class='clear'></div></div></div></div><div class='tipb'></div></div>");

            //设置关闭按钮事件
            $('#'+A+' .tipc > h2 img').click(function(){$('#'+A).hide();$('.ip_sidebg').hide();});

            //创建城市选择
            var d=$('#'+A+' div.tipmain > div.clear'),_e,_id;
            for (var k in auCity){
                _id="_mip_"+auCity[k].grp;

                //重点区域
                //if (auCity[k].itp==1){
                //    $('#'+A+' div.tipall').append("<a href='http://"+auCity[k].url+"/'>"+auCity[k].name+"</a>");
                //}

                //是否需要创建母体
                if ($('#'+_id).length<=0){
                    d.before("<p id='"+_id+"'><span>"+auCity[k].grp+"</span><strong></strong></p>");
                }

                $('#'+_id+' > strong').append("<a href='http://"+auCity[k].url+"/'>"+auCity[k].name+"</a>");
            }
        }
    };

    //静态定位
    var position = function(){
        //var isIE6 = !-[1,] && !window.XMLHttpRequest,html = document.getElementsByTagName('html')[0];
        var isIE6 = !-[1,] && !('minWidth' in c.doc.documentElement.style);

        return {
            fixed: function(e){
                if (isIE6){

                    // 给IE6 fixed 提供一个“不抖动的环境”
                    // 只需要 html 与 body 标签其一使用背景静止定位即可让IE6下滚动条拖动元素也不会抖动
                    // 注意：IE6如果 body 已经设置了背景图像静止定位后还给 html 标签设置会让 body 设置的背景静止(fixed)失效
                    var bg = 'backgroundAttachment';
                    if ($('html').css(bg) !== 'fixed' && $(c.doc.body).css(bg) !== 'fixed') {
                        $('html').css({backgroundImage: 'url(about:blank)',backgroundAttachment: 'fixed'});
                    };

                    var style = $(e).get(0).style,
                        dom = '(document.documentElement)',
                        left = parseInt($(e).css('left')) - document.documentElement.scrollLeft,
                        top = parseInt($(e).css('top')) - document.documentElement.scrollTop;
                    this.absolute(e);
                    style.setExpression('left', 'eval(' + dom + '.scrollLeft + ' + left + ') + "px"');
                    style.setExpression('top', 'eval(' + dom + '.scrollTop + ' + top + ') + "px"');

                }else{
                    $(e).css('position','fixed');
                }
            },
            absolute: function(e){
                if (isIE6){
                    var bg = 'backgroundAttachment';
                    if ($('html').css(bg) == 'fixed') {
                        $('html').css({backgroundImage: 'none',backgroundAttachment: 'scroll'});
                    };

                    var style = $(e).get(0).style;
                    style.removeExpression('left');
                    style.removeExpression('top');
                    style.position = 'absolute';
                }else{
                    $(e).css('position','absolute');
                }

            }
        };
    }();

    if (c.doc.domain.substr(0,3)=='www'){
        //检测是否存在跳转
        var e=c.getCke(c.cnm);//e=null;
        if (null!==e){
            //分站不需要跳转
            if (e.length>5 && c.loc.pathname=='/' && e.substr(7,3)!='www'){
                window.location.href=e;
                return false;
            }
        }else{
            //生成弹窗
            jQuery(function($){
                $.getJSON(c.uip,function(m){
                    var A='MyIpPop';

                    c.createCity(A,m);

                    //设置居中
                    position.fixed("#"+A);

                    //设置点击缓存事件
                    $('#'+A).show().find('div a').click(function(){ return c.setCity(this);});
                    $('.ip_sidebg').show();
                });
            });
        }
    }
    jQuery(function($){$('[eid=IPCN]').click(function(){c.showCity('MyIpTip',this)});});
})(jQuery);
